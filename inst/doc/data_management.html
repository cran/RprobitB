<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Lennart Oelschläger" />

<meta name="date" content="2021-11-12" />

<title>Data management</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Data management</h1>
<h4 class="author">Lennart Oelschläger</h4>
<h4 class="date">2021-11-12</h4>



<p>This vignette explains how to provide choice data for <strong>RprobitB</strong> via</p>
<ol style="list-style-type: decimal">
<li><p><a href="#empirical-data">empirical data</a> or</p></li>
<li><p><a href="#simulated-data">simulated data</a>.</p></li>
</ol>
<p>As a first step, we recommend to <a href="#specify-the-model-formula">specify the model formula</a>.</p>
<div id="specify-the-model-formula" class="section level2">
<h2>Specify the model formula</h2>
<p>The model formula is specified using a formula object, let’s call it <code>form</code>.</p>
<p>The structure of <code>form</code> is <code>choice ~ A | B | C</code>, where</p>
<ul>
<li><p><code>choice</code> is the discrete choice we aim to explain,</p></li>
<li><p><code>A</code> are alternative and choice situation specific covariates with a generic coefficient (we call them covariates of type 1),</p></li>
<li><p><code>B</code> are choice situation specific covariates with alternative specific coefficients (we call them covariates of type 2),</p></li>
<li><p>and <code>C</code> are alternative and choice situation specific covariates with alternative specific coefficients (we call them covariates of type 3).</p></li>
</ul>
<p>Keep the following rules in mind:</p>
<ul>
<li><p>By default, alternative specific constants are added to the model<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. They can be removed by adding <code>+0</code> in the second spot, e.g. <code>choice ~ A | B + 0</code>.</p></li>
<li><p>To exclude covariates of the backmost categories, use either <code>0</code>, e.g. <code>choice ~ A | B | 0</code> or just leave this part out and write <code>choice ~ A | B</code>. However, to exclude covariates of front categories, we have to use <code>0</code>, e.g. <code>choice ~ A | 0 | C</code>.</p></li>
<li><p>To include more than one covariate of the same category, use <code>+</code>, e.g. <code>choice ~ A1 + A2 | B</code>.</p></li>
<li><p>If we don’t want to include any covariates of the second category but we want to estimate alternative specific constants, add <code>1</code> in the second spot, e.g. <code>choice ~ A | 1</code>. The expression <code>choice ~ A | 0</code> is interpreted as no covariates of the second category and no alternative specific constants.</p></li>
</ul>
<p>To have random effects for specific variables, we need to define a character vector <code>re</code> of the corresponding variable names. To have random effects for the alternative specific constants, include <code>&quot;ASC&quot;</code> in <code>re</code>.</p>
<div id="example-simulated-choice-of-transportation-means" class="section level3">
<h3>Example: Simulated choice of transportation means</h3>
<p>Say we want to explain the <code>choice</code> of transportation means by the variables <code>cost</code>, <code>income</code>, and <code>travel_time</code>. We furthermore want to add alternative specific constants.</p>
<ul>
<li><p>The <code>cost</code> of an alternative is obviously alternative specific. However, we can argue that it does not matter for which alternative we spend our money. Therefore, we want to estimate a generic coefficient for <code>cost</code>.</p></li>
<li><p>The <code>income</code> of a decision maker is constant across alternatives, but can have a different influence on the alternatives. It is therefore a covariate of type 2.</p></li>
<li><p>The <code>travel_time</code> is a covariate of type 3: It is alternative specific but in contrast to the <code>cost</code>, we can imagine that spending time in public transportation means is different from spending time in ones own car.</p></li>
</ul>
<p>Therefore, we specify:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>form <span class="ot">=</span> choice <span class="sc">~</span> cost <span class="sc">|</span> income <span class="sc">|</span> travel_time</span></code></pre></div>
<p>We typically would expect heterogeneity in preferences regarding spending money on a transportation means, therefore we impose a random effect on <code>cost</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>re <span class="ot">=</span> <span class="st">&quot;cost&quot;</span></span></code></pre></div>
</div>
</div>
<div id="empirical-data" class="section level2">
<h2>Empirical data</h2>
<p>This section explains how to prepare empirical data for estimation using the function <code>prepare()</code>.</p>
<p>Say we have a data set with empirical choice data, let’s call it <code>choice_data</code>. It must meet the following requirements:</p>
<ol style="list-style-type: decimal">
<li><p>It must be a data frame.</p></li>
<li><p>It must be in wide format, that means each row represents one choice occasion.</p></li>
<li><p>It must contain a column named <code>id</code>, which contains a unique identifier for each decision maker.</p></li>
<li><p>It must contain a column named <code>choice</code>, where <code>choice</code> must match the name of the dependent variable in <code>form</code>.</p></li>
<li><p>For each alternative specific covariate <code>p</code> in <code>form</code> and each choice alternative <code>j</code>, <code>choice_data</code> must contain a column named <code>p_j</code>.</p></li>
<li><p>For each covariate <code>q</code> that is constant across covariates (covariate of type 2), <code>choice_data</code> must contain a column named <code>q</code>.</p></li>
</ol>
<p>To prepare <code>choice_data</code> for estimation, we must call</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">prepare</span>(<span class="at">form =</span> form, <span class="at">choice_data =</span> choice_data)</span></code></pre></div>
<p>The function <code>prepare()</code> has the following optional arguments:</p>
<ul>
<li><p><code>alternatives</code>: We may not want to consider all alternatives in <code>choice_data</code>. In that case, we can specify a character vector <code>alternatives</code> with selected names of alternatives.</p></li>
<li><p><code>re</code>: The character vector of variable names of <code>form</code> with random effects.</p></li>
<li><p><code>id</code>: A character, the name of the column in <code>choice_data</code> that contains a unique identifier for each decision maker. The default is <code>&quot;id&quot;</code>.</p></li>
<li><p><code>standardize</code>: A character vector of variable names of <code>form</code> that get standardized, see <a href="#standardize-covariates">below</a>.</p></li>
</ul>
<div id="example-train-data-set-of-the-mlogit-package" class="section level3">
<h3>Example: “Train” data set of the mlogit package</h3>
<p>Let’s prepare the <em>Train</em> data set of the <a href="https://cran.r-project.org/package=mlogit">mlogit package</a> for estimation. We consider the covariates <code>price</code> (type 1), <code>time</code>, <code>comfort</code> and <code>change</code> (each of type 3), where we link <code>price</code> and <code>time</code> to random effects<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Train&quot;</span>, <span class="at">package =</span> <span class="st">&quot;mlogit&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">prepare</span>(<span class="at">form =</span> choice <span class="sc">~</span> price <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> time <span class="sc">+</span> comfort <span class="sc">+</span> change, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">choice_data =</span> Train,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">re =</span> <span class="fu">c</span>(<span class="st">&quot;price&quot;</span>,<span class="st">&quot;time&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="simulated-data" class="section level2">
<h2>Simulated data</h2>
<p>This section explains how to simulate choice data using the function <code>simulate()</code>.</p>
<p>If we want to simulate the choices of <code>N</code> deciders in <code>T</code> choice occasions<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> among <code>J</code> alternatives from our model formulation <code>form</code>, we have to call</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">simulate</span>(<span class="at">form =</span> form, <span class="at">N =</span> N, <span class="at">T =</span> T, <span class="at">J =</span> J)</span></code></pre></div>
<p>The function <code>simulate()</code> has the following optional arguments:</p>
<ul>
<li><p><code>re</code>: The character vector of variable names of <code>form</code> with random effects.</p></li>
<li><p><code>alternatives</code>: A character vector with the names of the choice alternatives with length <code>J</code>.</p></li>
<li><p><code>distr</code>: A named list of number generation functions from which the covariates are drawn. Each element of <code>distr</code> must be of the form <code>&quot;cov&quot; = list(&quot;name&quot; = &quot;&lt;name of the number generation function&gt;&quot;, ...)</code>, where <code>cov</code> is the name of the covariate<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> and <code>...</code> are required parameters for the number generation function. Covariates for which no distribution is specified are drawn from a standard normal distribution. Possible number generation functions are</p>
<ul>
<li><p>functions of the type <code>r*</code> from base R (e.g. <code>rnorm</code>) where all required parameters (except for <code>n</code>) must be specified,</p></li>
<li><p>the function <code>sample</code>, where all required parameters except for <code>size</code>) must be specified.</p></li>
</ul></li>
<li><p><code>standardize</code>: A character vector of variable names of <code>form</code> that get standardized, see <a href="#standardize-covariates">below</a>.</p></li>
</ul>
<p>We can specify true parameter values by adding values for</p>
<ul>
<li><p><code>alpha</code>, the fixed coefficient vector,</p></li>
<li><p><code>C</code>, the number (greater or equal 1) of latent classes of decision, makers</p></li>
<li><p><code>s</code>, the vector of class weights,</p></li>
<li><p><code>b</code>, the matrix of class means as columns,</p></li>
<li><p><code>Omega</code>, the matrix of class covariance matrices as columns,</p></li>
<li><p><code>Sigma</code>, the differenced error term covariance matrix,</p></li>
<li><p><code>Sigma_full</code>, the full error term covariance matrix.</p></li>
</ul>
<div id="example-simulated-choice-of-transportation-means-1" class="section level3">
<h3>Example: Simulated choice of transportation means</h3>
<p>We revisit our example of the simulated choice of transportation means, where we already specified:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>form <span class="ot">=</span> choice <span class="sc">~</span> cost <span class="sc">|</span> income <span class="sc">|</span> travel_time</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>re <span class="ot">=</span> <span class="st">&quot;cost&quot;</span></span></code></pre></div>
<p>Let us now simulate the choices of <code>N = 100</code> decision makers in <code>T = 10</code> choice occasions on the <code>J = 3</code> alternatives “car”, “bus” and “train”. We want <code>C = 2</code> true latent classes and specific distributions<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> for our covariates:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>T <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>J <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>alternatives <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;car&quot;</span>, <span class="st">&quot;bus&quot;</span>, <span class="st">&quot;train&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>distr <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;cost&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;rnorm&quot;</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;income&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span>  <span class="st">&quot;sample&quot;</span>, <span class="at">x =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">*</span><span class="fl">1e3</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;travel_time_car&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;rlnorm&quot;</span>, <span class="at">meanlog =</span> <span class="dv">1</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;travel_time_bus&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;rlnorm&quot;</span>, <span class="at">meanlog =</span> <span class="dv">2</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">simulate</span>(<span class="at">form =</span> form, <span class="at">N =</span> N, <span class="at">T =</span> T, <span class="at">J =</span> J, <span class="at">re =</span> re,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">alternatives =</span> alternatives, <span class="at">distr =</span> distr, <span class="at">C =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
</div>
<div id="standardize-covariates" class="section level2">
<h2>Standardize covariates</h2>
<p>Both <code>simulate()</code> and <code>prepare()</code> have the optional input <code>standardize</code>, which is a character vector of names of covariates that get standardized, i.e. normalize to mean 0 and standard deviation 1. If <code>standardize = &quot;all&quot;</code>, all covariates get standardized.</p>
<p>Covariates of type 1 or 3 have to be addressed by <code>covariate_alternative</code>.</p>
<p>If <code>standardize = &quot;all&quot;</code>, all covariates get standardized.</p>
<div id="example-simulated-choice-of-transportation-means-2" class="section level3">
<h3>Example: Simulated choice of transportation means</h3>
<p>In our example of the simulated choice of transportation means, scaling the <code>income</code> is reasonable and can improve model fitting. For demonstration purpose, we also standardize <code>travel_time</code> for each alternative:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>standardize <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;income&quot;</span>, <span class="st">&quot;travel_time_car&quot;</span>, <span class="st">&quot;travel_time_bus&quot;</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;travel_time_train&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">simulate</span>(<span class="at">form =</span> form, <span class="at">N =</span> N, <span class="at">T =</span> T, <span class="at">J =</span> J, <span class="at">re =</span> re,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">alternatives =</span> alternatives, <span class="at">parm =</span> parm, <span class="at">distr =</span> distr,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">standardize =</span> standardize)</span></code></pre></div>
</div>
</div>
<div id="data-summary" class="section level2">
<h2>Data summary</h2>
<p>We can check if the data preparation or simulation worked as expected using the <code>summary()</code> function. The columns <code>z</code> and <code>re</code> indicate standardized and random effect covariates, respectively. The rest of the output is self-explanatory.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code></pre></div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Alternative specific constants can be interpreted as covariates of type 2. Due to the dummy variable trap, we cannot estimate alternative specific constants for all the alternatives. Therefore, they are added for all except for the last alternative.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Note that alternative specific constants are excluded here.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><code>T</code> can be either a positive number, representing a fixed number of choice occasions for each decision maker, or a vector of length <code>N</code>, i.e. a decision maker specific number of choice occasions.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>For a covariate <code>cov</code> of type 1 or 3, you can either choose <code>&quot;name&quot; = cov</code> (to draw the covariate for all alternatives from the same distribution) or <code>&quot;name&quot; = cov_alternative</code> (to draw the covariate for a specific alternative from a specific distribution).<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Note that the <code>cost</code> covariate for all alternatives is drawn from the same distribution. Also note that since we did not specify a distribution for <code>travel_time_bus</code>, this covariate is drawn from a standard normal distribution.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
